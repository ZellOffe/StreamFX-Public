# AUTOGENERATED COPYRIGHT HEADER START
# Copyright (C) 2019-2023 Michael Fabian 'Xaymar' Dirks <info@xaymar.com>
# AUTOGENERATED COPYRIGHT HEADER END

name: Build

on:
  workflow_dispatch:
  push:
    branches:
      - '*'
    tags:
      - '*'
  pull_request:
    branches:
      - '*'

concurrency:
  group: build-${{ github.ref_name }}
  cancel-in-progress: true

env:
  CACHE_VERSION: "2022-12-02"

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        os: [ "windows", "macos" ]
        runner: [ "windows-2022", "macos-12" ]
        name: [ "Windows", "MacOS" ]
        compiler: [ "MSVC", "Clang" ]
        qt: [ 6 ]
        include:
          - os: "windows"
            runner: "windows-2022"
            compiler: "MSVC"
            name: "Windows"
            CMAKE_SYSTEM_VERSION: "10.0.20348.0"
            CMAKE_GENERATOR: "Visual Studio 17 2022"
            CMAKE_GENERATOR_PLATFORM: "x64"
            package_name: "windows"
          - os: "macos"
            runner: "macos-12"
            compiler: "Clang"
            name: "MacOS"
            CMAKE_GENERATOR: "Xcode"
            CMAKE_OSX_DEPLOYMENT_TARGET: "10.15"
            CMAKE_OSX_ARCHITECTURES: "x86_64;arm64"
            package_name: "macos"
    runs-on: "${{ matrix.runner }}"
    name: "${{ matrix.name }} (${{ matrix.compiler }})"
    env:
      CMAKE_GENERATOR: "${{ matrix.CMAKE_GENERATOR }}"
      CMAKE_GENERATOR_PLATFORM: "${{ matrix.CMAKE_GENERATOR_PLATFORM }}"
      CMAKE_SYSTEM_VERSION: "${{ matrix.CMAKE_SYSTEM_VERSION }}"
      CMAKE_OSX_DEPLOYMENT_TARGET: "${{ matrix.CMAKE_OSX_DEPLOYMENT_TARGET }}"
      CMAKE_OSX_ARCHITECTURES: "${{ matrix.CMAKE_OSX_ARCHITECTURES }}"
    steps:
      - name: "Clone Repository"
        uses: actions/checkout@v3
        with:
          submodules: recursive
          fetch-depth: 0

      # Add additional steps here...

      - name: "Build Process"
        shell: bash
        run: |
          cmake -S . -B build \
            -DCMAKE_SYSTEM_VERSION="${{ env.CMAKE_SYSTEM_VERSION }}" \
            -DCMAKE_OSX_DEPLOYMENT_TARGET="${{ env.CMAKE_OSX_DEPLOYMENT_TARGET }}" \
            -DCMAKE_GENERATOR="${{ matrix.CMAKE_GENERATOR }}" \
            -DQt${{ matrix.qt }}_DIR="${{ github.workspace }}/build/qt" \
            -Dlibobs_DIR="${{ github.workspace }}/build/obs/install"

      - name: "Artifacts Upload"
        uses: actions/upload-artifact@v3
        with:
          name: "${{ matrix.name }}-${{ matrix.compiler }}"
          path: "build/*"
